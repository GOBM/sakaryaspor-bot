import requests
from bs4 import BeautifulSoup
from PIL import Image, ImageDraw, ImageFont
import os
import re
import smtplib
from email.message import EmailMessage

# --- AYARLAR ---
LOG_DOSYASI = "paylasilanlar.txt"
SABLON_YOLU = "sablon.png"
FONT_YOLU = "Sancreek-Regular.ttf"

# --- MAIL AYARLARI (GitHub Secrets'dan gelecek) ---
MAIL_ADRESI = os.getenv("oguzhanmerakli1@gmail.com")
MAIL_SIFRESI = os.getenv("2510Oguz") # Gmail Uygulama Åžifresi
ALICI_MAIL = os.getenv("oguzhanmerakli@gmail.com")

def mail_gonder(gorsel_yolu, isim):
    try:
        msg = EmailMessage()
        msg['Subject'] = f'Yeni BaÄŸÄ±ÅŸÃ§Ä± GÃ¶rseli: {isim}'
        msg['From'] = MAIL_ADRESI
        msg['To'] = ALICI_MAIL
        msg.set_content(f'Sakaryaspor iÃ§in yeni bir gÃ¶rsel oluÅŸturuldu: {isim}')

        with open(gorsel_yolu, 'rb') as f:
            file_data = f.read()
            msg.add_attachment(file_data, maintype='image', subtype='png', filename=f'{isim}.png')

        with smtplib.SMTP_SSL('smtp.gmail.com', 465) as smtp:
            smtp.login(MAIL_ADRESI, MAIL_SIFRESI)
            smtp.send_message(msg)
        print(f"ðŸ“§ Mail gÃ¶nderildi: {isim}")
    except Exception as e:
        print(f"ðŸ“§ Mail hatasÄ±: {e}")

# ... (GÃ¶rsel oluÅŸturma ve denetle fonksiyonlarÄ± aynÄ± kalacak) ...
# Sadece gorsel_olustur fonksiyonunun sonuna mail_gonder(kayit_adi, isim) satÄ±rÄ±nÄ± ekleyeceÄŸiz.
